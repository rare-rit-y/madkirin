#made by _unicornia. (github: rare-rit-y)

bac_coc_debug_cat = {
    bac_skip_to_commonalty_tree = {
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
            has_country_flag = KIC_children_of_concord_flag
			check_variable = { coc_start_foci_completed < 10 }
		}
		complete_effect = {
			set_variable = { coc_start_foci_completed = 10 }
            mark_focus_tree_layout_dirty = yes
			complete_national_focus = BAC_COC_true_commonalty
			every_possible_country = {
				limit = {
					has_character = KIC_rising_sun_u
				}
				KIC_rising_sun_u = { # Rising Sun technical university
					set_character_name = bac_CIT
					set_nationality = PREV.PREV
				}
			}
			set_power_balance = {
				id = BAC_commonalty_bop
			}
		}
    
    }
    bac_get_commonalty_start_foci = {
    
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
            has_country_flag = KIC_children_of_concord_flag
			check_variable = { coc_start_foci_completed > 3 }
		}
		complete_effect = {
			set_variable = { coc_start_foci_completed = 0 }
            mark_focus_tree_layout_dirty = yes
			complete_national_focus = BAC_COC_finale
		}
    
    }
    bac_get_commonalty_war_tree = {
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
            has_country_flag = KIC_children_of_concord_flag
			NOT = { has_country_flag = COC_war_committee_flag }
		}
		complete_effect = {
			set_country_flag = COC_war_committee_flag
            mark_focus_tree_layout_dirty = yes
		}
    }
}
economy_decisions = { #Economic Policy
	bac_finish_railway = {
		icon = GFX_decision_generic_train
		allowed = { original_tag = KIC }
		visible = {
			has_completed_focus = BAC_COC_eco_head
			NOT = {
				has_railway_connection = {
					start_province = 20626
					target_province = 16648
				}
			}
		}
		available = {
			has_full_control_of_state = 1069
			has_full_control_of_state = 1073
			has_full_control_of_state = 1076
			has_full_control_of_state = 1077
		}
		highlight_states = {
			highlight_state_targets = {
				state = 1069
				state = 1073
			}
		}
		cost = 20
		days_remove = 30
		ai_will_do = {
			factor = 200
		}
		fire_only_once = yes
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove bac_finish_railway"
			capital_scope = {
				increase_state_category = yes
				add_victory_points = {
					province = 20626
					value = 9
				}
			}
			country_event = { id = kirin.36 hours = 1 }
			hidden_effect = {
				build_railway = {
					level = 1
					fallback = yes
					start_province = 16648
					target_province = 20626
				}
			}
		}
		cancel_trigger = {
			hidden_trigger = {
				has_railway_connection = {
					start_province = 20626
					target_province = 16648
				}
			}
		}
	}


	BAC_cocc_dance_magic_and_its_electric = {
		icon = GFX_decision_generic_electricity
		allowed = {
			original_tag = KIC
		}

		visible = {
			ROOT = {
				has_country_flag = BAC_COC_eco_m4m_flag
			}
			FROM = {
				NOT = { has_dynamic_modifier = { modifier = BAC_its_electric_state } }
			}
		}

		state_target = any_controlled_state
		target_array = core_states
		on_map_mode = map_only

		cost = 33
		days_remove = 33
		days_re_enable = 365
		fire_only_once = yes
		modifier = {
			political_power_factor = -0.3
			consumer_goods_factor = 0.03
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision BAC_cocc_dance_magic_and_its_electric target: [From.GetName]"
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove BAC_cocc_dance_magic_and_its_electric target: [From.GetName]"
			FROM = {
				increase_state_category = yes
				add_dynamic_modifier = { modifier = BAC_its_electric_state }
			}
		}
		cancel_trigger = {
			FROM = {
				NOT = {
					is_controlled_by = ROOT
				}
			}
		}
	}
}
political_actions = {
	BAC_military_aid_to_civil = {

		icon = GFX_decision_generic_army_support

		available = {
			has_war = no
			if = {
				limit = { tag = EQC }
				NOT = {
					has_country_flag = is_maresoc
                }
            }
            if = {
			  limit = {
				   original_tag = BAK
				}
				NOT = {
				   has_idea = BAK_elections
				}
			}
			if = {
				limit = {
					tag = WIN
				}
				NOT = {
					has_idea = WIN_chaos_in_the_city
				}
			}
		}

		visible = {
			always = yes
			OR = {
			    if = {
			        limit = { original_tag = TRD }
			        has_government = communism
				}
				if = {
			        limit = { original_tag = TRD }
			        has_government = fascism
				}
			    if = {
			        limit = { original_tag = TRD }
					AND = {
			            has_government = democratic
				        has_completed_focus = TRD_altesburg
					}
				}
			}
			if = {
				limit = { original_tag = BAL }
				NOT = { is_subject_of = CHN }
			}
		}

		fire_only_once = no

		modifier = {
			stability_weekly = 0.001
			command_power_gain = -0.1
			training_time_army_factor = -0.1
			planning_speed = -0.1
			experience_gain_army_factor = -0.1
		}

		days_remove = 180
		days_re_enable = 540

		cost = 100

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision BAC_military_aid_to_civil"

		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 1
				has_stability < 0.8
			}
			modifier = {
				add = 1
				has_stability < 0.6
			}
			modifier = {
				add = 5
				has_stability < 0.5
			}
			modifier = {
				add = 10
				has_stability < 0.3
			}
			modifier = {
				factor = 0
				num_of_civilian_factories_available_for_projects < 10
			}
		}
	}
}
# military_training_category = {
# }
commonalty_bop_category = {
    comm_WPU_1 = {
        icon = GFX_decision_category_viirats
		allowed = { original_tag = KIC } 
		cost = 33
        visible = {
        }
        available = {
        }
        days_remove = 33
		modifier = {
            power_balance_weekly = -0.033
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision comm_WPU_1"
            bac_WPU_small_effect = yes
		}
        remove_effect = {
        }
    }
    comm_COT_1 = {
        icon = GFX_decision_candle
		allowed = { original_tag = KIC }
		cost = 33
        visible = {
        }
        available = {
        }
        days_remove = 33
		modifier = {
            power_balance_weekly = 0.033
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision comm_COT_1"
            bac_COT_small_effect = yes
		}
        remove_effect = {
        }
    }
}
foreign_politics = {

	BAC_COC_embassy = {
		icon = SOV_place_hq
		allowed = {
			original_tag = KIC
		}

		ai_will_do = {
			factor = 25
			modifier = {
				FROM = {
					any_neighbor_state = {
						owner = {
							OR = {
								tag = ROOT
								is_ally_with = ROOT
							}
						}
					}
				}
				add = 10
			}
		}

		visible = {
			ROOT = {
				has_country_flag = bac_diplo_expanded
				any_owned_state = {
					is_coastal = yes
					is_fully_controlled_by = ROOT
				}
			}
			FROM = {
				is_capital = yes
				owner = {
					has_full_control_of_state = PREV
					NOT = {
						has_war_with = ROOT
						has_opinion_modifier = commonalty_embassy
						has_idea = detached_country
						tag = EQS
					}
					OR = {
						is_neighbor_of = ROOT
						capital_scope = { is_on_continent = africa }
					}
					any_owned_state = {
						is_coastal = yes
						is_fully_controlled_by = ROOT
					}
					if = {
						limit = { ROOT = { is_ai = no } }
						has_opinion = { target = ROOT value > 0 }
					}
				}
			}
		}

		state_target = yes # we can put an embassy anywhere
		on_map_mode = map_only
		target_array = COC.COC_EMBASSY_ARRAY
		fire_only_once = yes

		cost = 75
		days_remove = 30

		modifier = {
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision BAC_COC_embassy target: [From.GetName]"
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove BAC_COC_embassy target: [From.GetName]"
			custom_effect_tooltip = BAC_COC_embassy_tt
			hidden_effect = {
				FROM.owner = {
					add_opinion_modifier = {
						target = ROOT
						modifier = commonalty_embassy
					}
					add_relation_modifier = {
						target = ROOT
						modifier = commonalty_embassy
					}
					ROOT = {
						add_opinion_modifier = {
							target = PREV
							modifier = commonalty_embassy
						}
						add_relation_modifier = {
							target = PREV
							modifier = commonalty_embassy
						}
						add_opinion_modifier = {
							target = PREV
							modifier = commonalty_embassy_trade
						}
					}
				}
			}
		}
		cancel_trigger = {
			FROM.owner = {
				has_war_with = ROOT
			}
		}
	}

	commonalty_add_you_faction_decision = {
		icon = generic_protection
		allowed = {
			original_tag = KIC
		}
		ai_will_do = {
			factor = 25
		}

		visible = {
			has_country_flag = commonalty_ending_flag
			is_faction_leader = yes
		}

		available = {
			FROM = {
				OR = {
					has_opinion_modifier = commonalty_embassy
					has_opinion = { target = ROOT value > 74 }
				}
				has_war = no
				OR = {
					AND = {
						ROOT = { is_ai = no }
						any_owned_state = {
							is_controlled_by = FROM
							is_coastal = yes
						}
					}
					any_neighbor_country = {
						OR = {
							tag = ROOT
							is_ally_with = ROOT
						}
					}
				}
			}
		}

		target_trigger = {
			FROM = {
				#capital_scope = { is_on_continent = africa }
				OR = {
					has_government = democratic
					has_government = communism
				}
				is_subject = no
				NOT = {
					#original_tag = DEL
					is_in_faction = yes
					is_faction_leader = yes
					is_in_faction_with = ROOT
					has_idea = detached_country
				}
				OR = {
					is_neighbor_of = ROOT
					AND = {
						ROOT = { is_ai = no }
						OR = {
							check_variable = { closest_distance_to@ROOT < 800 }
							ROOT = {
								any_allied_country = {
									OR = {
										check_variable = { closest_distance_to@FROM < 150 }
										is_neighbor_of = FROM
									}
								}
							}
						}
					}
				}
			}
		}

		cost = 33
		days_re_enable = 180

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove commonalty_add_you_faction_decision"
			FROM = {
				country_event = baccocc.146
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision commonalty_add_you_faction_decision"
		}
	}
	commonalty_asks_to_join_your_faction_decision = {
		icon = generic_protection
		allowed = {
			original_tag = KIC
		}
		ai_will_do = {
			#factor = 25
		}

		visible = {
			has_country_flag = commonalty_bop_fucked_flag
			is_faction_leader = yes
		}

		available = {
			FROM = {
				OR = {
					has_opinion_modifier = commonalty_embassy
					has_opinion = { target = ROOT value > 74 }
				}
				has_war = no
				OR = {
					AND = {
						ROOT = { is_ai = no }
						any_owned_state = {
							is_controlled_by = FROM
							is_coastal = yes
						}
					}
					any_neighbor_country = {
						OR = {
							tag = ROOT
							is_ally_with = ROOT
						}
					}
				}
			}
		}

		target_trigger = {
			FROM = {
				#capital_scope = { is_on_continent = africa }
				if = {
					limit = {
						is_power_balance_side_active = {
							id = BAC_commonalty_bop
							side = commonalty_harmonic_control
						}
					}
					OR = {
						tag = event_target:equestria
						tag = event_target:solar_empire
					}
				}
				else = {
					has_government = communism
					is_faction_leader = yes
				}
				is_subject = no
				NOT = {
					is_in_faction_with = ROOT
				}
			}
		}

		cost = 99
		days_re_enable = 180

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove commonalty_asks_to_join_your_faction_decision"
			FROM = {
				country_event = baccocc.29
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision commonalty_asks_to_join_your_faction_decision"
		}
	}
}