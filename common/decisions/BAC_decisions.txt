#made by _unicornia. (github: rare-rit-y)

bac_coc_debug_cat = {
    bac_skip_to_commonalty_tree = {
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
            has_country_flag = KIC_children_of_concord_flag
			check_variable = { baccocc_start_foci_completed < 10 }
		}
		complete_effect = {
			set_variable = { baccocc_start_foci_completed = 10 }
			set_country_flag = BAC_get_commonalty_flag
            mark_focus_tree_layout_dirty = yes
			complete_national_focus = BAC_COC_true_commonalty
			every_possible_country = {
				limit = {
					has_character = KIC_rising_sun_u
				}
				KIC_rising_sun_u = { # Rising Sun technical university
					set_character_name = bac_CIT
					set_nationality = PREV.PREV
				}
			}
			set_power_balance = {
				id = BAC_commonalty_bop
			}
		}
    
    }
    bac_get_commonalty_start_foci = {
    
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
            has_country_flag = KIC_children_of_concord_flag
			check_variable = { baccocc_start_foci_completed > 3 }
		}
		complete_effect = {
			set_variable = { baccocc_start_foci_completed = 0 }
            mark_focus_tree_layout_dirty = yes
			complete_national_focus = BAC_COC_finale
		}
    
    }
    bac_get_commonalty_war_tree = {
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
            has_country_flag = KIC_children_of_concord_flag
			NOT = { has_country_flag = COC_war_committee_flag }
		}
		complete_effect = {
			set_country_flag = COC_war_committee_flag
            mark_focus_tree_layout_dirty = yes
		}
    }
    bac_wpu_mega_effect_debug = {
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
			has_any_power_balance = yes
		}
		complete_effect = {
			bac_WPU_mega_effect = yes
		}
    }
    bac_cot_mega_effect_debug = {
        allowed = {
            original_tag = KIC
        }
		visible = {
			is_debug = yes
			has_any_power_balance = yes
		}
		complete_effect = {
			bac_cot_mega_effect = yes
		}
    }
}
economy_decisions = { #Economic Policy
	bac_finish_railway = {
		icon = GFX_decision_generic_train
		allowed = { original_tag = KIC }
		visible = {
			has_completed_focus = BAC_COC_eco_head
			NOT = {
				has_railway_connection = {
					start_province = 20626
					target_province = 16648
				}
			}
		}
		available = {
			num_of_civilian_factories_available_for_projects > 2
			has_full_control_of_state = 1069
			has_full_control_of_state = 1073
			has_full_control_of_state = 1076
			has_full_control_of_state = 1077
		}
		highlight_states = {
			highlight_state_targets = {
				state = 1073
				state = 1069
			}
		}
		cost = 30
		days_remove = 45
		ai_will_do = {
			factor = 200
		}
		modifier = {
			consumer_goods_factor = 0.09
			civilian_factory_use = 3
		}
		fire_only_once = yes
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove bac_finish_railway"
			capital_scope = {
				increase_state_category = yes
				add_victory_points = {
					province = 20626
					value = 9
				}
			}
			country_event = { id = baccocc.36 hours = 1 }
			hidden_effect = {
				build_railway = {
					level = 1
					fallback = yes
					start_province = 16648
					target_province = 20626
				}
			}
		}
		cancel_trigger = {
			hidden_trigger = {
				has_railway_connection = {
					start_province = 20626
					target_province = 16648
				}
			}
		}
	}


	BAC_cocc_dance_magic_and_its_electric = {
		icon = GFX_decision_generic_electricity
		allowed = {
			original_tag = KIC
		}

		visible = {
			ROOT = {
				has_country_flag = BAC_COC_eco_m4m_flag
			}
			FROM = {
				NOT = { has_dynamic_modifier = { modifier = BAC_its_electric_state } }
			}
		}
		available = {
			num_of_civilian_factories_available_for_projects > 8
		}

		state_target = any_controlled_state
		target_array = core_states
		on_map_mode = map_only

		cost = 33
		days_remove = 33
		days_re_enable = 365
		fire_only_once = yes
		modifier = {
			political_power_factor = -0.9
			consumer_goods_factor = 0.09
			civilian_factory_use = 9
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision BAC_cocc_dance_magic_and_its_electric target: [From.GetName]"
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove BAC_cocc_dance_magic_and_its_electric target: [From.GetName]"
			FROM = {
				increase_state_category = yes
				add_dynamic_modifier = { modifier = BAC_its_electric_state }
			}
		}
		cancel_trigger = {
			FROM = {
				NOT = {
					is_controlled_by = ROOT
				}
			}
		}
	}
}
political_actions = {
	BAC_military_aid_to_civil = {

		icon = GFX_decision_generic_army_support

		available = {
			has_war = no
			if = {
				limit = { tag = EQC }
				NOT = {
					has_country_flag = is_maresoc
                }
            }
            if = {
			  limit = {
				   original_tag = BAK
				}
				NOT = {
				   has_idea = BAK_elections
				}
			}
			if = {
				limit = {
					tag = WIN
				}
				NOT = {
					has_idea = WIN_chaos_in_the_city
				}
			}
		}

		visible = {
			always = yes
			OR = {
			    if = {
			        limit = { original_tag = TRD }
			        has_government = communism
				}
				if = {
			        limit = { original_tag = TRD }
			        has_government = fascism
				}
			    if = {
			        limit = { original_tag = TRD }
					AND = {
			            has_government = democratic
				        has_completed_focus = TRD_altesburg
					}
				}
			}
			if = {
				limit = { original_tag = BAL }
				NOT = { is_subject_of = CHN }
			}
		}

		fire_only_once = no

		modifier = {
			stability_weekly = 0.001
			command_power_gain = -0.1
			training_time_army_factor = -0.1
			planning_speed = -0.1
			experience_gain_army_factor = -0.1
		}

		days_remove = 180
		days_re_enable = 540

		cost = 100

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision BAC_military_aid_to_civil"

		}

		ai_will_do = {
			base = 0
			modifier = {
				add = 1
				has_stability < 0.8
			}
			modifier = {
				add = 1
				has_stability < 0.6
			}
			modifier = {
				add = 5
				has_stability < 0.5
			}
			modifier = {
				add = 10
				has_stability < 0.3
			}
		}
	}
}


#operations = {
	# BAC_kill_pirates = {
	# 	icon = GFX_decision_generic_army_support
	# 	available = {
	# 		has_completed_focus = BAC_COC_mil_navy
	# 		if = {
	# 			limit = {
	# 				is_ai = no
	# 			}
	# 			custom_trigger_tooltip = {
	# 				tooltip = KIR_focus_10b_ship_tt
	# 				ships_in_state_ports = {
	# 					size > 0
	# 					state = 833
	# 				}
	# 			}
	# 		}
	# 	}
	# 	visible = {
	# 		has_country_flag = BAC_get_commonalty_flag
	# 	}
	
	# 	ai_will_do = {
	# 		factor = 50
	# 	}
	# 	complete_effect = {
	# 		log = "[GetDateText]: [Root.GetName]: decision BAC_kill_pirates"
	# 		add_stability = 0.05
	# 		add_war_support = 0.1
	# 	}
	# }
#}
#military_training_category = {
#}

commonalty_bop_category = {
    comm_WPU_1 = {
        icon = GFX_decision_category_viirats
		allowed = { original_tag = KIC } 
		cost = 33
        visible = {
        }
        available = {
        }
        days_remove = 33
		days_re_enable = 180
		modifier = {
            power_balance_weekly = -0.033
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision comm_WPU_1"
            bac_WPU_small_effect = yes
		}
        remove_effect = {
        }
    }
    comm_COT_1 = {
        icon = GFX_decision_candle
		allowed = { original_tag = KIC }
		cost = 33
        visible = {
        }
        available = {
        }
        days_remove = 33
		days_re_enable = 180
		modifier = {
            power_balance_weekly = 0.033
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision comm_COT_1"
            bac_COT_small_effect = yes
		}
        remove_effect = {
        }
    }
	comm_COT_wuxia = {
        icon = GFX_decision_kirin_vanguard
		allowed = { original_tag = KIC }
		cost = 33
        available = {
			has_completed_focus = BAC_COC_pol_head
        }
        days_remove = 99
		days_re_enable = 180
		modifier = {
			stability_factor = 0.03
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_COT_wuxia"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_COT_wuxia"
			add_stability = 0.03
			if = {
				limit = { bac_hasnt_researched_all_kirin_techs = yes }
				add_tech_bonus = {
					name = race_tech_bonus
					bonus = 0.33
					uses = 1
					category = race_tech
				}
			}
			else = { add_political_power = 33 }
			every_core_state = {
				population_increase_0_1 = yes
			}
			custom_effect_tooltip = KIR_line_break
			bac_COT_small_effect = yes
        }
	}


	comm_COT_pursuit = { #Pursuit The Heathen Remnant
        icon = GFX_decision_fire
		allowed = { original_tag = KIC }
		cost = 100
        visible = {
			has_completed_focus = BAC_COC_pol_h1
        }
        available = {
			any_controlled_state = {
				has_resistance = yes
			}
        }
        days_remove = 99
		days_re_enable = 180
		modifier = {
			command_power_gain = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_COT_pursuit"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_COT_pursuit"
			add_popularity = {
				ideology = democratic
				popularity = -0.033
			}
			every_controlled_state = {
				limit = { has_resistance = yes }
				add_extra_state_shared_building_slots = 1
				random_select_amount = 3
				population_reduction_1 = yes
				add_resistance = -9
				add_compliance = 3
			}
			custom_effect_tooltip = comm_COT_pursuit_tt
			#bac_WPU_small_effect = yes
        }
    }
	
	comm_WPU_WOF = { #Religious Interchange Programme
        icon = GFX_decision_kirin_scroll
		allowed = { original_tag = KIC }
		cost = 100
        visible = {
			NOT = { has_completed_focus = BAC_COC_pol_h1 }
        }
        available = {
			has_completed_focus = BAC_COC_pol_c2
        }
        days_remove = 99
		days_re_enable = 180
		modifier = {
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_WPU_WOF"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_WPU_WOF"
			add_popularity = {
				ideology = communism
				popularity = 0.03
			}
			every_controlled_state = {
				limit = { has_resistance = yes }
				add_extra_state_shared_building_slots = 1
				random_select_amount = 3
				add_compliance = 3
			}
			custom_effect_tooltip = KIR_line_break
            bac_WPU_small_effect = yes
        }
    }

	comm_WPU_rural = { #Redistribution Programme
        icon = GFX_decision_straw_hat
		allowed = { original_tag = KIC }
		cost = 33
        visible = {
        }
        available = {
			has_completed_focus = BAC_COC_eco_head
        }
        days_remove = 33
		days_re_enable = 99
		modifier = {
			consumer_goods_factor = 0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_WPU_rural"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_WPU_rural"
			add_stability = 0.03
			add_popularity = {
				ideology = communism
				popularity = 0.03
			}
			every_core_state = {
				population_increase_0_1 = yes
			}
			custom_effect_tooltip = KIR_line_break
            bac_WPU_small_effect = yes
        }
    }
	comm_WPU_NH = { #Support Local Collective
        icon = GFX_decision_kirin_corvee
		allowed = { original_tag = KIC }
		cost = 33
        available = {
			has_idea = BAC_COC_eco_h1_idea
			num_of_civilian_factories_available_for_projects > 2
        }
        days_remove = 99
		days_re_enable = 365
		modifier = {
			civilian_factory_use = 3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_WPU_NH"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_WPU_NH"
			add_tech_bonus = {
				name = industrial_bonus
				bonus = 0.33
				uses = 1
				category = industry
			}
			every_core_state = {
				population_increase_0_1 = yes
			}
			custom_effect_tooltip = KIR_line_break
			bac_eqs_popularity = yes
            bac_COT_small_effect = yes
        }
    }


	comm_WPU_commiebro = { #Seek Solidarity With International Socialists
        icon = GFX_decision_hammer_and_horseshoe_decision
		allowed = { original_tag = KIC }
		cost = 100
        visible = {
        }
        available = {
			has_completed_focus = BAC_COC_diplo
			any_other_country = {
				exists = yes
				has_government = communism
				is_major = yes
				is_subject = no
				has_opinion_modifier = commonalty_embassy
				NOT = {
					has_war_with = ROOT
				}
				surrender_progress < 0.1
				if = {
					limit = {
						ROOT = { is_ai = no }
					}
					has_opinion = { target = ROOT value > 99 }
				}
			}
        }
        days_remove = 99
		days_re_enable = 365
		modifier = {
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_WPU_commiebro"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_WPU_commiebro"
			add_offsite_building = {
				type = industrial_complex
				level = 1
			}
			add_tech_bonus = {
				name = industrial_bonus
				bonus = 0.33
				uses = 1
				category = industry
			}
			add_popularity = {
				ideology = communism
				popularity = 0.03
			}
			custom_effect_tooltip = KIR_line_break
            bac_WPU_medium_effect = yes
        }
    }

	comm_COT_CES = { #Welcome Missionaries From The Lodge
        icon = GFX_decision_celestia
		allowed = { original_tag = KIC }
		cost = 33
        available = {
			if = {
				limit = { country_exists = CES }
				country_exists = CES
				CES = { has_opinion_modifier = commonalty_embassy }
			}
			else_if = {
				limit = { country_exists = event_target:solar_empire }
				country_exists = event_target:solar_empire
				event_target:solar_empire = { has_opinion_modifier = commonalty_embassy }
			}
			else = {
				country_exists = event_target:equestria
				event_target:equestria = { has_opinion_modifier = commonalty_embassy }
			}
			num_of_civilian_factories_available_for_projects > 2
        }
        days_remove = 99
		days_re_enable = 365
		modifier = {
			political_power_factor = -0.3
			civilian_factory_use = 3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_COT_CES"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_COT_CES"
			if = {
				limit = { bac_hasnt_researched_all_kirin_techs = yes }
				add_tech_bonus = {
					name = race_tech_bonus
					bonus = 1.0
					uses = 1
					category = race_tech
				}
			}
			else = { add_political_power = 100 }
			custom_effect_tooltip = KIR_line_break
			bac_eqs_popularity = yes
            bac_COT_small_effect = yes
        }
    }






    comm_COT_civ = { #Equestrian Economic Aid
        icon = GFX_decision_generic_factory
		allowed = { original_tag = KIC }
		cost = 100
        visible = {
        }
        available = {
			event_target:equestria = {
				exists = yes
				is_subject = no
				has_opinion_modifier = commonalty_embassy
				NOT = {
					has_war_with = ROOT
				}
				surrender_progress < 0.1
				if = {
					limit = {
						ROOT = { is_ai = no }
					}
					has_opinion = { target = ROOT value > 99 }
				}
			}
        }
        days_remove = 99
		days_re_enable = 365
		modifier = {
			political_power_factor = -0.3
		}
        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: take Decision comm_COT_civ"
		}
        remove_effect = {
			log = "[GetDateText]: [Root.GetName]: remove Decision comm_COT_civ"
			add_offsite_building = {
				type = industrial_complex
				level = 1
			}
			add_tech_bonus = {
				name = industrial_bonus
				bonus = 0.33
				uses = 1
				category = industry
			}
			custom_effect_tooltip = KIR_line_break
			bac_eqs_popularity = yes
            bac_COT_medium_effect = yes
        }
    }

}


foreign_politics = {
	bac_funni_red_button = {
		icon = GFX_decision_fire
		allowed = {
			original_tag = KIC
		}
		ai_will_do = {
			factor = 25
		}

		visible = {
			has_country_flag = commonalty_ending_flag
		}
		cost = 303

        complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision bac_funni_red_button"
            every_other_country = {
				limit = {
					has_government = neutrality
					has_government = fascism
				}
				ROOT = {
					declare_war_on = {
						target = PREV
						type = annex_everything
					}
				}
			}
		}
	}
	BAC_COC_embassy = {
		icon = SOV_place_hq
		allowed = {
			original_tag = KIC
		}

		ai_will_do = {
			factor = 25
			modifier = {
				FROM = {
					any_neighbor_state = {
						owner = {
							OR = {
								tag = ROOT
								is_ally_with = ROOT
							}
						}
					}
				}
				add = 10
			}
		}

		visible = {
			ROOT = {
				has_country_flag = bac_diplo_expanded
				any_owned_state = {
					is_coastal = yes
					is_fully_controlled_by = ROOT
				}
			}
			FROM = {
				is_capital = yes
				owner = {
					is_subject = no
					does_not_have_tribal_society = yes
					has_full_control_of_state = PREV
					NOT = {
						has_war_with = ROOT
						has_opinion_modifier = commonalty_embassy
						has_idea = detached_country
						has_idea = communal_society
					}
					if = {
						limit = { NOT = { has_completed_focus = BAC_COC_eco_h2 } }
						NOT = {
							tag = event_target:equestria
							tag = event_target:solar_empire
						}
					}
					OR = {
						is_neighbor_of = ROOT
						capital_scope = { is_on_continent = africa }
						any_owned_state = {
							is_coastal = yes
							is_fully_controlled_by = FROM
						}
						any_country = {
							OR = {
								is_ally_with = FROM
								is_subject_of = FROM #in case they don't have faction
							}
							any_owned_state = {
								is_coastal = yes
								is_fully_controlled_by = PREV
							}
						}
					}
				}
			}
		}
		available = {
			if = {
				limit = { ROOT = { is_ai = no } }
				FROM.owner = { has_opinion = { target = ROOT value > 0 } }
			}
		}

		state_target = yes # we can put an embassy anywhere
		on_map_mode = map_only
		target_array = ROOT.COC_EMBASSY_ARRAY
		fire_only_once = yes

		cost = 33
		days_remove = 30

		modifier = {
			political_power_factor = -0.09
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision BAC_COC_embassy target: [From.GetName]"
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove BAC_COC_embassy target: [From.GetName]"
			custom_effect_tooltip = BAC_COC_embassy_tt
			hidden_effect = {
				FROM.owner = {
					add_opinion_modifier = {
						target = ROOT
						modifier = commonalty_embassy
					}
					add_relation_modifier = {
						target = ROOT
						modifier = commonalty_embassy
					}
					ROOT = {
						add_opinion_modifier = {
							target = PREV
							modifier = commonalty_embassy
						}
						add_relation_modifier = {
							target = PREV
							modifier = commonalty_embassy
						}
						add_opinion_modifier = {
							target = PREV
							modifier = commonalty_embassy_trade
						}
					}
					add_ai_strategy = {
						type = antagonize
						id = ROOT
						value = -100
					}
				}
			}
		}
		cancel_trigger = {
			FROM.owner = {
				has_war_with = ROOT
			}
		}
	}

	commonalty_add_you_faction_decision = {
		icon = generic_protection
		allowed = {
			original_tag = KIC
		}
		ai_will_do = {
			factor = 25
		}

		visible = {
			has_country_flag = commonalty_ending_flag
			is_faction_leader = yes
		}

		available = {
			ROOT = {
				is_faction_leader = yes
			}
			FROM = {
				has_opinion_modifier = commonalty_embassy
				if = {
					limit = { is_ai = no }
					has_opinion = { target = ROOT value > 99 }
				}
				has_war = no
				OR = {
					AND = {
						ROOT = { is_ai = no }
						any_owned_state = {
							is_controlled_by = FROM
							is_coastal = yes
						}
					}
					any_neighbor_country = {
						OR = {
							tag = ROOT
							is_ally_with = ROOT
						}
					}
				}
			}
		}

		target_trigger = {
			FROM = {
				#capital_scope = { is_on_continent = africa }
				OR = {
					has_government = democratic
					has_government = communism
				}
				is_subject = no
				NOT = {
					#original_tag = DEL
					is_in_faction = yes
					is_faction_leader = yes
					is_in_faction_with = ROOT
					has_idea = detached_country
				}
				OR = {
					is_neighbor_of = ROOT
					AND = {
						ROOT = { is_ai = no }
						OR = {
							check_variable = { closest_distance_to@ROOT < 800 }
							ROOT = {
								any_allied_country = {
									OR = {
										check_variable = { closest_distance_to@FROM < 150 }
										is_neighbor_of = FROM
									}
								}
							}
						}
					}
				}
			}
		}

		cost = 33
		days_re_enable = 180

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove commonalty_add_you_faction_decision"
			FROM = {
				country_event = baccocc.146
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision commonalty_add_you_faction_decision"
		}
	}
	commonalty_asks_to_join_your_faction_decision = {
		icon = generic_protection
		allowed = {
			original_tag = KIC
		}
		ai_will_do = {
			#factor = 25
		}

		visible = {
			has_country_flag = bac_diplo_expanded
			OR = {
				check_variable = {
					var = power_balance_value
					value = -0.66
					compare = less_than_or_equals
				}
				check_variable = {
					var = power_balance_value
					value = 0.66
					compare = greater_than_or_equals
				}
			}
		}

		available = {
			has_war = no
			FROM = {
				NOT = { has_war_with = ROOT }
				has_opinion_modifier = commonalty_embassy
				if = {
					limit = { ROOT = { is_ai = no } }
					has_opinion = { target = ROOT value > 99 }
				}
			}
		}

		target_trigger = {
			FROM = {
				if = {
					limit = {
						ROOT = {
							power_balance_value = {
								id = BAC_commonalty_bop
								value > 0
							}
						}
					}
					if = {
						limit = { country_exists = event_target:solar_empire }
						tag = event_target:solar_empire
					}
					else = { tag = event_target:equestria }
				}
				else = {
					has_government = communism
					is_faction_leader = yes
				}
				is_subject = no
				NOT = {
					is_in_faction_with = ROOT
				}
				OR = {
					AND = {
						any_owned_state = {
							is_controlled_by = FROM
							is_coastal = yes
						}
					}
					any_neighbor_country = {
						OR = {
							tag = ROOT
							is_ally_with = ROOT
						}
					}
				}
			}
		}

		cost = 99
		days_re_enable = 180

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove commonalty_asks_to_join_your_faction_decision"
			FROM = {
				country_event = baccocc.29
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision commonalty_asks_to_join_your_faction_decision"
		}
	}
}